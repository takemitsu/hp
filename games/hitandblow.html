<!DOCTYPE html>
<html lang="ja" data-bs-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hit and Blow</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'JetBrains Mono', monospace;
    }
    
    #display {
      font-size: 2.5rem;
      letter-spacing: 0.5rem;
      min-height: 80px;
      background: var(--bs-gray-900);
      border: 2px solid var(--bs-primary);
    }
    
    [data-bs-theme="light"] #display {
      background: var(--bs-gray-100);
    }
    
    .numpad-btn {
      font-size: 1.5rem;
      font-weight: bold;
      height: 60px;
      width: 100%;
      touch-action: manipulation;
    }
    
    button {
      touch-action: manipulation;
    }
    
    .history-item {
      font-size: 1.2rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border-left: 4px solid var(--bs-primary);
    }
    
    .history-container {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .hit {
      color: var(--bs-success);
      font-weight: bold;
    }
    
    .blow {
      color: var(--bs-warning);
      font-weight: bold;
    }
    
    .guess-number {
      font-size: 1.4rem;
      letter-spacing: 0.2rem;
    }
    
    @media (max-width: 576px) {
      .numpad-btn {
        font-size: 1.2rem;
        height: 50px;
      }
      
      #display {
        font-size: 2rem;
        letter-spacing: 0.3rem;
      }
    }
  </style>
</head>
<body>
<nav class="navbar bg-body-tertiary" id="header" aria-label="header">
  <div class="container-fluid justify-content-start">
    <a class="navbar-brand" href="/">takemitsu.net</a>
    <div class="nav-text">Hit and Blow</div>
    
    <ul class="navbar-nav flex-row ms-auto mb-2 mb-lg-0">
      <li class="nav-item mx-1"><a class="nav-link" href="#" onclick="changeTheme('dark')">dark</a></li>
      <li class="nav-item mx-1"><a class="nav-link" href="#" onclick="changeTheme('light')">light</a></li>
    </ul>
  </div>
</nav>

<div class="container mt-3">
  <div class="row">
    <div class="col-lg-6 mb-3">
      <div class="card">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center">
            <span>„Ç≤„Éº„É†Ë®≠ÂÆö</span>
            <div class="btn-group btn-group-sm" role="group">
              <input type="radio" class="btn-check" name="digits" id="digit3" value="3">
              <label class="btn btn-outline-primary" for="digit3">3Ê°Å</label>
              <input type="radio" class="btn-check" name="digits" id="digit4" value="4" checked>
              <label class="btn btn-outline-primary" for="digit4">4Ê°Å</label>
              <input type="radio" class="btn-check" name="digits" id="digit5" value="5">
              <label class="btn btn-outline-primary" for="digit5">5Ê°Å</label>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div id="display" class="text-center rounded p-3 mb-3"></div>
          
          <div class="row g-2 mb-3">
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="1" aria-label="Êï∞Â≠ó1„ÇíÂÖ•Âäõ">1</button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="2" aria-label="Êï∞Â≠ó2„ÇíÂÖ•Âäõ">2</button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="3" aria-label="Êï∞Â≠ó3„ÇíÂÖ•Âäõ">3</button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="4" aria-label="Êï∞Â≠ó4„ÇíÂÖ•Âäõ">4</button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="5" aria-label="Êï∞Â≠ó5„ÇíÂÖ•Âäõ">5</button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="6" aria-label="Êï∞Â≠ó6„ÇíÂÖ•Âäõ">6</button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="7" aria-label="Êï∞Â≠ó7„ÇíÂÖ•Âäõ">7</button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="8" aria-label="Êï∞Â≠ó8„ÇíÂÖ•Âäõ">8</button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="9" aria-label="Êï∞Â≠ó9„ÇíÂÖ•Âäõ">9</button>
            </div>
            <div class="col-4">
              <button class="btn btn-secondary numpad-btn" id="clearBtn" aria-label="ÂÖ•Âäõ„Çí„ÇØ„É™„Ç¢">C</button>
            </div>
            <div class="col-4">
              <button class="btn btn-primary numpad-btn" data-num="0" aria-label="Êï∞Â≠ó0„ÇíÂÖ•Âäõ">0</button>
            </div>
            <div class="col-4">
              <button class="btn btn-warning numpad-btn" id="deleteBtn" aria-label="ÊúÄÂæå„ÅÆÊï∞Â≠ó„ÇíÂâäÈô§">‚å´</button>
            </div>
          </div>
          
          <div class="d-grid gap-2 mb-2">
            <button class="btn btn-success btn-lg" id="submitBtn" aria-label="Êé®Ê∏¨„ÇíÁ¢∫ÂÆö">Á¢∫ÂÆö</button>
          </div>
          
          <div class="row g-2">
            <div class="col-6">
              <button class="btn btn-outline-danger w-100" id="giveupBtn" aria-label="Á≠î„Åà„ÇíË¶ã„Çã">Á≠î„Åà„ÇíË¶ã„Çã</button>
            </div>
            <div class="col-6">
              <button class="btn btn-outline-info w-100" id="newGameBtn" aria-label="Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÇíÈñãÂßã">Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>Â±•Ê≠¥</span>
          <span id="tryCount" class="badge bg-primary">0Âõû</span>
        </div>
        <div class="card-body history-container" id="history">
          <div class="text-muted text-center">„Åæ„Å†Êé®Ê∏¨„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì</div>
        </div>
      </div>
      
      <div class="alert alert-info mt-3" role="alert">
        <h5 class="alert-heading">ÈÅä„Å≥Êñπ</h5>
        <ul class="mb-0">
          <li><strong>Hit</strong>: Êï∞Â≠ó„ÇÇ‰ΩçÁΩÆ„ÇÇÊ≠£„Åó„ÅÑ</li>
          <li><strong>Blow</strong>: Êï∞Â≠ó„ÅØÊ≠£„Åó„ÅÑ„Åå‰ΩçÁΩÆ„ÅåÈÅï„ÅÜ</li>
          <li>ÈáçË§á„Åó„Å™„ÅÑÊï∞Â≠ó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">üéâ Ê≠£Ëß£ÔºÅ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã"></button>
      </div>
      <div class="modal-body text-center">
        <h3 id="successMessage" aria-live="polite"></h3>
        <p class="mt-3">„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="startNewGame()">Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†</button>
      </div>
    </div>
  </div>
</div>

<script src="../setTheme.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>

<script type="text/javascript">
let answer = [];
let currentInput = [];
let tryCount = 0;
let currentDigits = 4;

const generateAnswer = (digits) => {
  const numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
  const result = [];
  
  for (let i = 0; i < digits; i++) {
    const index = Math.floor(Math.random() * numbers.length);
    result.push(numbers[index]);
    numbers.splice(index, 1);
  }
  
  return result;
};

const updateDisplay = () => {
  const displayEl = document.getElementById('display');
  if (currentInput.length === 0) {
    displayEl.textContent = '';
  } else {
    displayEl.textContent = currentInput.join('');
  }
};

const addNumber = (num) => {
  if (currentInput.length >= currentDigits) return;
  if (currentInput.includes(num)) return;
  
  currentInput.push(num);
  updateDisplay();
};

const deleteNumber = () => {
  currentInput.pop();
  updateDisplay();
};

const clearInput = () => {
  currentInput = [];
  updateDisplay();
};

const calculateHitBlow = (guess) => {
  let hit = 0;
  let blow = 0;
  
  for (let i = 0; i < guess.length; i++) {
    if (guess[i] === answer[i]) {
      hit++;
    } else if (answer.includes(guess[i])) {
      blow++;
    }
  }
  
  return { hit, blow };
};

const addHistory = (guess, hit, blow) => {
  const historyEl = document.getElementById('history');
  
  if (tryCount === 1) {
    historyEl.innerHTML = '';
  }
  
  const historyItem = document.createElement('div');
  historyItem.className = 'history-item bg-body-secondary rounded';
  
  const guessStr = guess.join('');
  historyItem.innerHTML = `
    <div class="d-flex justify-content-between align-items-center">
      <span class="guess-number">${guessStr}</span>
      <span>
        <span class="hit">${hit}H</span>
        <span class="blow ms-2">${blow}B</span>
      </span>
    </div>
  `;
  
  historyEl.insertBefore(historyItem, historyEl.firstChild);
};

const submit = () => {
  if (currentInput.length !== currentDigits) {
    alert(`${currentDigits}Ê°Å„ÅÆÊï∞Â≠ó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ`);
    return;
  }
  
  try {
    tryCount++;
    document.getElementById('tryCount').textContent = `${tryCount}Âõû`;
    
    const { hit, blow } = calculateHitBlow(currentInput);
    addHistory(currentInput, hit, blow);
    
    if (hit === currentDigits) {
      const successModal = new bootstrap.Modal(document.getElementById('successModal'));
      document.getElementById('successMessage').textContent = `${answer.join('')} - ${tryCount}Âõû„ÅßÊ≠£Ëß£ÔºÅ`;
      successModal.show();
    }
    
    clearInput();
  } catch (error) {
    console.error('„Ç≤„Éº„É†Âá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:', error);
    alert('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
  }
};

const giveUp = () => {
  try {
    if (confirm(`Á≠î„Åà„ÅØ ${answer.join('')} „Åß„Åó„Åü„ÄÇ\nÊñ∞„Åó„ÅÑ„Ç≤„Éº„É†„ÇíÂßã„ÇÅ„Åæ„Åô„ÅãÔºü`)) {
      startNewGame();
    }
  } catch (error) {
    console.error('„ÇÆ„Éñ„Ç¢„ÉÉ„ÉóÂá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:', error);
    alert('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
  }
};

const startNewGame = () => {
  try {
    answer = generateAnswer(currentDigits);
    currentInput = [];
    tryCount = 0;
    
    document.getElementById('tryCount').textContent = '0Âõû';
    document.getElementById('history').innerHTML = '<div class="text-muted text-center">„Åæ„Å†Êé®Ê∏¨„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì</div>';
    updateDisplay();
  } catch (error) {
    console.error('Êñ∞„Åó„ÅÑ„Ç≤„Éº„É†ÈñãÂßã‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:', error);
    alert('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
  }
};

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.numpad-btn[data-num]').forEach(btn => {
    btn.addEventListener('click', () => {
      addNumber(parseInt(btn.dataset.num));
    });
  });
  
  document.getElementById('deleteBtn').addEventListener('click', deleteNumber);
  document.getElementById('clearBtn').addEventListener('click', clearInput);
  document.getElementById('submitBtn').addEventListener('click', submit);
  document.getElementById('giveupBtn').addEventListener('click', giveUp);
  document.getElementById('newGameBtn').addEventListener('click', startNewGame);
  
  document.querySelectorAll('input[name="digits"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      currentDigits = parseInt(e.target.value);
      startNewGame();
    });
  });
  
  document.addEventListener('keydown', (e) => {
    if (e.key >= '0' && e.key <= '9') {
      addNumber(parseInt(e.key));
    } else if (e.key === 'Backspace') {
      deleteNumber();
    } else if (e.key === 'Enter') {
      submit();
    } else if (e.key === 'Escape') {
      clearInput();
    }
  });
  
  startNewGame();
});
</script>
</body>
</html>